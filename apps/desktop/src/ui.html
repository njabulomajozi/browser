<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segui UI', Roboto, Oxygen, Ubuntu, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f0f0f0;
        }

        /* Tab Bar */
        .tab-bar {
            display: flex;
            background: #e0e0e0;
            padding: 4px 4px 0 4px;
            gap: 2px;
            height: 40px;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #d0d0d0;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            max-width: 200px;
            min-width: 100px;
        }

        .tab.active {
            background: white;
        }

        .tab-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 13px;
        }

        .tab-close {
            cursor: pointer;
            color: #666;
            font-size: 16px;
            line-height: 1;
        }

        .tab-close:hover {
            color: #000;
        }

        .tab-new {
            padding: 8px 12px;
            background: #d0d0d0;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .tab-new:hover {
            background: #c0c0c0;
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            gap: 8px;
            padding: 8px;
            background: white;
            border-bottom: 1px solid #ccc;
            height: 48px;
        }

        button {
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #f5f5f5;
        }

        button:active {
            background: #e0e0e0;
        }

        #url-input {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        #url-input:focus {
            outline: none;
            border-color: #0066cc;
        }

        /* Info message (child WebView renders below) */
        .info {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Tab Bar -->
    <div class="tab-bar" id="tab-bar">
        <div class="tab active" data-tab-id="0">
            <span class="tab-title">New Tab</span>
        </div>
        <div class="tab-new" onclick="createTab()">+</div>
    </div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
        <button onclick="goBack()">←</button>
        <button onclick="goForward()">→</button>
        <button onclick="reload()">⟳</button>
        <input
            type="text"
            id="url-input"
            placeholder="Enter URL or search..."
            value="https://example.com"
            onkeypress="handleUrlKeypress(event)"
        />
        <button onclick="navigate()">Go</button>
    </div>

    <!-- Info (child WebView renders below this chrome) -->
    <div class="info">
        <p>Content WebView renders below (88px from top)</p>
    </div>

    <script>
        // Browser state
        let state = {
            tabs: [
                { id: 0, title: 'New Tab', url: 'https://example.com' }
            ],
            activeTab: 0
        };

        // Send IPC message to Rust
        function sendIPC(message) {
            console.log('[IPC] Sending:', message);
            window.ipc.postMessage(JSON.stringify(message));
        }

        // Update UI from state
        function updateUI() {
            // Update tab bar
            const tabBar = document.getElementById('tab-bar');
            const tabs = state.tabs.map((tab, index) => `
                <div class="tab ${index === state.activeTab ? 'active' : ''}"
                     data-tab-id="${tab.id}"
                     onclick="switchTab(${index})">
                    <span class="tab-title">${tab.title}</span>
                    ${state.tabs.length > 1 ? `<span class="tab-close" onclick="event.stopPropagation(); closeTab(${index})">×</span>` : ''}
                </div>
            `).join('');
            tabBar.innerHTML = tabs + '<div class="tab-new" onclick="createTab()">+</div>';

            // Update URL bar
            const activeTab = state.tabs[state.activeTab];
            if (activeTab) {
                document.getElementById('url-input').value = activeTab.url;
            }
        }

        // Navigation functions (send IPC to Rust)
        function navigate() {
            const url = document.getElementById('url-input').value;
            console.log('[NAVIGATE] Input:', url);
            let fullUrl = url;

            // Add protocol if missing
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                // Check if it's a search query or URL
                if (url.includes(' ') || !url.includes('.')) {
                    // Search query
                    fullUrl = 'https://www.google.com/search?q=' + encodeURIComponent(url);
                } else {
                    // Assume URL
                    fullUrl = 'https://' + url;
                }
            }

            console.log('[NAVIGATE] Processed URL:', fullUrl);
            state.tabs[state.activeTab].url = fullUrl;
            document.getElementById('url-input').value = fullUrl;

            // Send IPC message to Rust
            sendIPC({
                cmd: 'Navigate',
                data: { url: fullUrl }
            });
        }

        function goBack() {
            console.log('[NAV] Go back');
            sendIPC({ cmd: 'GoBack' });
        }

        function goForward() {
            console.log('[NAV] Go forward');
            sendIPC({ cmd: 'GoForward' });
        }

        function reload() {
            console.log('[NAV] Reload');
            sendIPC({ cmd: 'Reload' });
        }

        function handleUrlKeypress(event) {
            if (event.key === 'Enter') {
                navigate();
            }
        }

        // Tab management
        function createTab() {
            console.log('[TAB] Create new tab');
            const newTab = {
                id: Date.now(),
                title: 'New Tab',
                url: 'https://example.com'
            };
            state.tabs.push(newTab);
            state.activeTab = state.tabs.length - 1;
            updateUI();
            navigate();
        }

        function closeTab(index) {
            console.log('[TAB] Close tab', index);
            if (state.tabs.length === 1) return; // Keep at least one tab

            state.tabs.splice(index, 1);
            if (state.activeTab >= state.tabs.length) {
                state.activeTab = state.tabs.length - 1;
            }
            updateUI();
            navigate();
        }

        function switchTab(index) {
            console.log('[TAB] Switch to tab', index);
            state.activeTab = index;
            updateUI();
            navigate();
        }

        // Initial setup
        console.log('[INIT] Browser chrome ready');
        updateUI();
    </script>
</body>
</html>
